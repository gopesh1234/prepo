<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, Roboto, Arial, sans-serif;
            background: #eef1f5;
            color: #212121;
        }

        .page {
            max-width: 1200px;
            margin: auto;
            padding: 16px;
        }

        .main {
            display: flex;
            gap: 16px;
        }

        .left-panel {
            width: 40%;
        }

        .right-panel {
            width: 90%;
            background: #ffffff;
            border-radius: 10px;
            padding: 12px;
            box-shadow: 0 6px 18px rgba(0,0,0,.08);
            height: 420px;
            display: flex;
            flex-direction: column;
        }

        .row {
            background: #ffffff;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,.05);
        }

        input, select {
            width: 100%;
            padding: 12px;
            font-size: 14px;
            border-radius: 6px;
            border: 1px solid #cfd4dc;
            margin-bottom: 8px;
        }

        button {
            width: 100%;
            margin-top: 6px;
            padding: 12px;
            border-radius: 6px;
            border: none;
            background: #2563eb;
            color: white;
            cursor: pointer;
        }

            button.danger {
                background: #dc2626;
            }

        .cards {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto;
        }

        .card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 12px;
            border-left: 6px solid #2563eb;
        }

            /* üÜï Difficulty colors */
            .card.easy {
                border-left-color: #16a34a;
            }

            .card.medium {
                border-left-color: #eab308;
            }

            .card.hard {
                border-left-color: #dc2626;
            }

        .card-actions {
            display: flex;
            gap: 6px;
            margin-bottom: 6px;
            width: 20%;
            margin-left: 80%;
        }

            .card-actions button {
                padding: 6px;
                font-size: 12px;
                border-radius: 4px;
            }

        .edit-btn {
            background: #059669;
        }

        .delete-card {
            background: #ef4444;
        }

        @@media (max-width: 768px) {
            .main {
                flex-direction: column;
            }

            .left-panel, .right-panel {
                width: 100%;
            }

            .right-panel {
                height: auto;
            }
        }
    </style>
</head>

<body>

    <div class="page">
        <div class="main">

            <div class="left-panel">

                <div class="row">
                    <input id="newOption" placeholder="Add dropdown value" />
                    <button onclick="addOption()">Add</button>
                </div>

                <div class="row">
                    <select id="dropdown" onchange="renderCards()"></select>
                </div>

                <div class="row">
                    <select id="categoryFilter" onchange="filterByCategory()">
                        <option value="Vocab">Vocab</option>
                        <option value="Idioms">Idioms</option>
                        <option value="OWS">OWS</option>
                        <option value="Prepo">Prepo</option>
                        <option value="SVA">SVA</option>
                        <option value="PV">PV</option>
                        <option value="Grammar">Grammar</option>
                        <option value="Books">Books</option>
                        <option value="States">States</option>
                    </select>
                </div>

                <div class="row">
                    <!-- üÜï Difficulty selector -->
                    <select id="difficulty">
                        <option value="easy">Easy</option>
                        <option value="medium">Medium</option>
                        <option value="hard">Hard</option>
                    </select>

                    <input id="cardText" placeholder="Add text for selected dropdown" oninput="autoFilter()" />
                    <button onclick="addCard()">Save</button>
                    <button class="danger" onclick="deleteDropdown()">Delete Dropdown</button>
                </div>

            </div>

            <div class="right-panel">
                <button onclick="downloadPDF()" style="width:13%; margin-left:85%;">PDF</button>
                <div id="cardContainer" class="cards"></div>
            </div>

        </div>
    </div>

    <script>
        let data = JSON.parse(localStorage.getItem("dropdownData")) || {};
        const dropdown = document.getElementById("dropdown");

        function autoFilter() {
            const input = document.getElementById("cardText").value.toLowerCase().trim();
            const container = document.getElementById("cardContainer");
            container.innerHTML = "";

            if (!input) {
                renderCards();
                return;
            }

            const firstLetter = input.charAt(0);

            // üî• AUTO-CHANGE DROPDOWN BASED ON FIRST LETTER
            const dropdownOptions = Array.from(dropdown.options).map(o => o.value);
            const matched = dropdownOptions.find(opt =>
                opt.toLowerCase().startsWith(firstLetter)
            );
            if (matched) dropdown.value = matched;

            Object.keys(data).sort().forEach(dropKey => {
                data[dropKey].forEach((item, index) => {

                    // ‚úÖ WORKS FOR STRING + OBJECT DATA
                    const text = typeof item === "string" ? item : item.text;

                    if (text.toLowerCase().includes(input)) {
                        const div = document.createElement("div");
                        div.className = "card";

                        div.innerHTML = `
                            <small style="color:#2563eb;font-weight:600;">${dropKey}</small>
                            <div class="card-actions">
                                <button disabled>‚ñ≤</button>
                                <button disabled>‚ñº</button>
                                <button class="delete-card"
                                    onclick="deleteCard('${dropKey}', ${index})">‚úñ</button>
                            </div>
                            <strong>${text}</strong>
                        `;
                        container.appendChild(div);
                    }
                });
            });

            if (!container.children.length) {
                container.innerHTML = `<p style="color:#6b7280;">No match found</p>`;
            }
        }


        /* üÜï Backward compatibility */
        function normalizeData() {
            Object.keys(data).forEach(k => {
                data[k] = data[k].map(item => {
                    if (typeof item === "string") {
                        return { text: item, difficulty: "easy" };
                    }
                    return item;
                });
            });
        }
        normalizeData();

        function saveData() {
            localStorage.setItem("dropdownData", JSON.stringify(data));
        }

        function sortCards(arr) {
            arr.sort((a, b) => a.text.localeCompare(b.text, undefined, { sensitivity: "base" }));
        }

        function loadDropdown() {
            dropdown.innerHTML = "";
            Object.keys(data).sort().forEach(k => {
                const o = document.createElement("option");
                o.value = k; o.textContent = k;
                dropdown.appendChild(o);
            });
        }

        function addOption() {
            const v = newOption.value.trim();
            if (!v || data[v]) return;
            data[v] = [];
            saveData(); loadDropdown();
            dropdown.value = v;
            newOption.value = "";
            renderCards();
        }

        function addCard() {
            const text = cardText.value.trim();
            const cat = categoryFilter.value;
            const diff = difficulty.value;
            const sel = dropdown.value;
            if (!text || !sel) return;

            const finalText = cat ? `${cat} ‚Äì ${text}` : text;
            data[sel].unshift({ text: finalText, difficulty: diff });
            sortCards(data[sel]);
            saveData();
            cardText.value = "";
            renderCards();
        }

        function renderCards() {
            const c = document.getElementById("cardContainer");
            c.innerHTML = "";
            const sel = dropdown.value;
            if (!sel) return;

            sortCards(data[sel]);

            data[sel].forEach((item, i) => {
                const d = document.createElement("div");
                d.className = `card ${item.difficulty}`;
                d.innerHTML = `
                    <div class="card-actions">
                        <button class="edit-btn" onclick="editCard(${i})">‚úèÔ∏è</button>
                        <button class="delete-card" onclick="deleteCard('${sel}',${i})">‚úñ</button>
                    </div>
                    <strong>${i + 1}. ${item.text}</strong>
                `;
                c.appendChild(d);
            });
        }

        function editCard(i) {
            const sel = dropdown.value;
            const item = data[sel][i];
            const card = document.getElementById("cardContainer").children[i];

            card.innerHTML = `
                <input id="editText" value="${item.text}">
                <select id="editDiff">
                    <option value="easy">Easy</option>
                    <option value="medium">Medium</option>
                    <option value="hard">Hard</option>
                </select>
                <button onclick="saveEdit(${i})">Save</button>
                <button onclick="renderCards()">Cancel</button>
            `;
            editDiff.value = item.difficulty;
        }

        function saveEdit(i) {
            const sel = dropdown.value;
            data[sel][i] = {
                text: editText.value.trim(),
                difficulty: editDiff.value
            };
            saveData();
            renderCards();
        }

        function deleteCard(k, i) {
            if (!confirm("Delete this card?")) return;
            data[k].splice(i, 1);
            saveData(); renderCards();
        }

        function deleteDropdown() {
            const s = dropdown.value;
            if (!s || !confirm(`Delete "${s}" and all its data?`)) return;
            delete data[s];
            saveData(); loadDropdown(); renderCards();
        }

        function filterByCategory() {
            const cat = categoryFilter.value.toLowerCase();
            const c = document.getElementById("cardContainer");
            c.innerHTML = "";
            Object.keys(data).sort().forEach(k => {
                if (k.toLowerCase().startsWith(cat)) {
                    data[k].forEach((item, i) => {
                        const d = document.createElement("div");
                        d.className = `card ${item.difficulty}`;
                        d.innerHTML = `<strong>${item.text}</strong>`;
                        c.appendChild(d);
                    });
                }
            });
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            let first = true;

            Object.keys(data).sort().forEach(k => {
                if (!data[k].length) return;
                if (!first) doc.addPage();
                first = false;

                doc.setFontSize(14);
                doc.setTextColor(0);
                doc.text(k, 10, 15);
                let y = 25;

                data[k].forEach((it, i) => {
                    let col = [0, 0, 0];
                    if (it.difficulty === "easy") col = [22, 163, 74];
                    if (it.difficulty === "medium") col = [234, 179, 8];
                    if (it.difficulty === "hard") col = [220, 38, 38];

                    doc.setTextColor(...col);
                    doc.text(`${i + 1}. ${it.text}`, 10, y);
                    y += 8;

                    doc.setDrawColor(...col);
                    doc.line(10, y, 200, y);
                    y += 6;

                    if (y > 280) { doc.addPage(); y = 20; }
                });
            });

            doc.save("Hi_Kumar_" + Date.now() + ".pdf");
        }

        loadDropdown();
        renderCards();
    </script>

</body>
</html>
